---
title: "What Makes a Successful Formula One Team?"
author: by ECK
output: github_document
---

```{r, libraries-and-data, echo = FALSE, message = FALSE}
library(tidyverse)
library(broom)
library(here)
library(skimr)
library(glue)
library(forcats)
#library(wordcountaddin)

f1merged <- read_csv("/cloud/project/data/f1merged.csv")
f1merged_hybrid <- read_csv("/cloud/project/data/f1merged_hybrid.csv")

key_team_colours_wins <- c("AlphaTauri" = "grey",
                           "Ferrari" = "#dc0000",
                           "Mercedes" = "#00d2be",
                           "Racing Point" = "#F596C8",
                           "Red Bull" = "#0600ef")

key_teams <- c("Ferrari", 
               "McLaren",
               "Mercedes",
               "Red Bull",
               "Williams")
```


## Summary

#### Introduction
Formula One, or F1, is the highest class of single-seater racing and one of the most prestigious racing series around the world. 
  
Each season, around 10 constructors (or "teams") build a car to strict regulations and race them at more than 20 circuits across the globe. A constructor fields two drivers and earns points towards two separate championships; one for the driver and one for the constructor who score the most points over a season.
  
We wanted to investigate the factors that make a successful F1 team - is speed the only metric that matters? Or do small gains made in pit stop times or reliability make all the difference?

In our analysis we combined the data sets *results, races, drivers* and *constructors* and focused only on entries in the hybrid era (2014-2020 excluding the 2021 season which was ongoing at the time of this analysis). This resulting data set was called *f1merged_hybrid*.


#### Dataset
To answer this question, we wanted to analyse how several predictor variables from our data set impacted a team's performance. Since our data is actually a combination of multiple data sets, we combined the data sets *results, races, drivers* and *constructors* and focused only on entries in the hybrid era (2014-2020 excluding the 2021 season which is ongoing at the time of this analysis). This resulting data set was called *f1merged_hybrid*.
  
In picking out a successful Formula One team from recent years there is one obvious candidate.

```{r, wins-pie-chart, echo = FALSE}

f1merged_hybrid %>%
  filter(positionText == 1) %>%
count(constructorname, sort = TRUE) %>% 
  ggplot(aes(x = "",
             y = n,
             fill = constructorname)) +
  geom_bar(stat = "identity") + 
  coord_polar('y', start = 0) +
  scale_fill_manual(values = key_team_colours_wins) +
  labs(title = "Race Wins by Constructor",
       subtitle = "In the hybrid era (2014-2020)",
       fill = "Constructor") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x  = element_blank()) +
  theme_void() +
  annotate(geom = "text", x = "", y = 68,  label = "74%", 
           color = "white", size = 12, fontface = "bold") +     #Mercedes
  annotate(geom = "text", x = "", y = 18,  label = "<1%",  
           color = "white", size = 3.5, fontface = "bold") +    #Racing Point
  annotate(geom = "text", x = "", y = 11.5,  label = "12%", 
           color = "white", size = 5, fontface = "bold") +      #Red Bull
  annotate(geom = "text", x = "", y = 126, label = "12%", 
           color = "white", size = 5, fontface = "bold") +      #Ferrari
  annotate(geom = "text", x = "", y = 138,   label = "<1%",  
           color = "white", size = 3.5, fontface = "bold")      #Alpha Tauri
```

Mercedes-AMG Petronas F1 team have won the Drivers' and Constructors' championships 7 years running, with a near unprecedented level of dominance. We looked at Mercedes specifically, as well as a comparison group containing 4 other teams that competed against them during the same era.

We can see this isn't just one good Mercedes driver - plotting the constructors against their finishing positions, we can see that Mercedes will almost always place in the top 5. So, what is it that makes Mercedes such a dominant team?


#### Speed
Could the answer to our question simply be that Mercedes are outright faster than their competitors? We investigated the average lap time of each key team and found that Mercedes has only a slight advantage in median lap time over the likes of Ferrari and Red Bull. If speed was the deciding factor in races, we would expect Ferrari and Red Bull to have comparable levels of success to Mercedes. 

Does this tiny speed advantage make a significant difference in Formula One?
We investigated this by plotting average lap time against finishing position. We found little correlation between a driver's average speed and their finishing position (shown by an almost flat regression line). Thus, Mercedes' success is unlikely to be explained by a slightly higher speed *during the race*.


#### Qualifying
So what difference *does* a small advantage in speed make? We would expect tiny advantages in pace to be most significant during the qualifying sessions that set the starting grid for the race, decided purely on the fastest lap time each driver can set in a qualifying race.

After plotting qualifying position against finishing position, our model showed a strong correlation between the two, suggesting a good qualifying session is necessary to perform well. However, the plot seemed to show particularly heavy clustering near the front of the field. To investigate this, we split the data for drivers qualifying in the top 5 from the rest of the field and modelled each separately.

As suspected, there was a stronger relationship between qualifying position and finishing position for the drivers qualifying in the top 5. In other words, if a driver qualifies near the front, they are likely to stay there. This could be due to less opportunity for collisions (particularly at the start) and possibly less time stuck behind another racer.

Summary statistics show that Mercedes took pole position more than 78% of the time in the hybrid era. Our qualifying model would predict them to have many podiums (top 3 finish) and wins based on this alone, which lines up with our previous findings.


#### Reliability
We identified mechanical reliability as a possible predictor of success. We plotted and modelled retirements per season* against points per season for each of our key teams and found a strong linear relationship between the two, if  a little skewed by the teams in our comparison group. Teams with fewer retirements in a season would be expected to score far more points than those who frequently failed to finish.


#### Pit Stops
Similarly, we hypothesized that a team with quicker average pit stop times would perform better - a slow stop can often be the difference between gaining or losing a place on track. 
Plotting and modelling this, we found a strong linear relationship between median pit stop time and points scored per season. Despite our intercept not making sense in practice and our slope being slightly skewed by our comparison group, it predicts a team would score 230 fewer points in a season for each second they add to their median stop time.

We combined our two models predicting total points per season - this combined model had an adjusted R^2 value of 0.397, suggesting that around 40% of the variability in points per season can be explained by this model.


#### Conclusion
Our analysis allows us to go some way towards answering our question - "What makes a successful F1 team?"

Speed is certainly important - to see strong results, a team needs a car capable of qualifying consistently near the front of the grid. However, for a team to achieve the impressive results that Mercedes has had in the hybrid era, they need more than just a fast car - fast and consistent pit stops as well as the best reliability on the grid have helped Mercedes go from a good team to one of the all-time greats.


#### Limitations
*We were not able to separate mechanical from non-mechanical retirements (collisions etc.) in our analysis, so used retirements for any reason as proxy.

As comparing driver skill between teams is extremely difficult and comparing between teammates would not help to answer our question, we have not included individual driver skill in our analysis.


## Presentation

Our presentation can be found [here](presentation/presentation.html).

## Data 

The data we have used in this project is from the Ergast Developer API, which has collected its data from the official race classifications released by the FIA (Formula One's governing body).

Ergast, A 2009, *Ergast Developer API*, data zip file,
The Ergast Developer API,
retrieved 22nd October 2021, <http://ergast.com/mrd/>

## References

Ergast, A 2009, *Ergast Developer API*, data zip file,
The Ergast Developer API,
retrieved 22nd October 2021, <http://ergast.com/mrd/>

