---
title: "What Makes a Successful Formula One Team?"
subtitle: <font size='6'>An analysis of Mercedes-AMG Petronas F1 Team in the turbo hybrid era</font>
author: <font size='6'>ECK <br>Eila Tether, Callum Stewart & Kai Morgan</font>
institute: <font size='7'>University of Edinburgh</font>
date: <font size = '6'>`r Sys.Date()`</font>
output:
  revealjs::revealjs_presentation:
    self_contained: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(readr)
library(dplyr)
library(skimr)
library(here)
library(forcats)
library(tidymodels)
library(rmarkdown)
library(palmerpenguins)
library(knitr)
library(revealjs)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
#Datasets
f1merged_hybrid <- read_csv("/cloud/project/data/f1merged_hybrid.csv")
f1merged_hybrid <- read_csv(here("data/f1merged_hybrid.csv"))
stops_merged <- read_csv(here("data/stops_merged.csv"))

#Lists and Colours
key_teams <- c("Ferrari", 
               "McLaren",
               "Mercedes",
               "Red Bull",
               "Williams")

team_colours <- c("Mercedes" = "#00d2be",
                  "Red Bull" = "#0600ef",
                  "Ferrari" = "#dc0000",
                  "Racing Point" = "#F596C8",
                  "Force India" = "#f596c8",
                  "AlphaTauri" = "#ffffff",
                  "McLaren" = "#ff8700",
                  "Renault" = "#fff500",
                  "Williams" = "#0082fa",
                  "Toro Rosso" = "#469BFF",
                  "Lotus F1" = "#000000",
                  "Alfa Romeo" = "#960000",
                  "Sauber" = "#960000",
                  "Haas F1 Team" = "#787878")

key_team_colours <- c("Ferrari" = "#dc0000",
                       "McLaren" = "#ff8700",
                       "Mercedes" = "#00d2be",
                       "Red Bull" = "#0600ef",
                       "Williams" = "#0082fa")

key_team_colours_wins <- c("AlphaTauri" = "grey",
                           "Ferrari" = "#dc0000",
                           "Mercedes" = "#00d2be",
                           "Racing Point" = "#F596C8",
                           "Red Bull" = "#0600ef")

key_team_colours_darker <- c("Williams" = "#0065C3",
                           "Ferrari" = "#A20000",
                           "Mercedes" = "#00A595",
                           "Red Bull" = "#040090",
                           "McLaren" = "#BF6500")
```




```{r f1-logo, echo = FALSE, out.width = "20%", fig.align = "left"}
include_graphics("https://www.channelnews.com.au/wp-content/uploads/2021/02/F1-3d.jpg")
```

Formula One is the highest class of single-seater racing in the world.

. . .

The racers compete in over 20 circuits across the globe.

```{r track-map, echo = FALSE, out.width = "40%", fig.align = "center"}
include_graphics("https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Tuscany_Circuit.png.transform/9col/image.png")
```

----

<font size='5'>We wanted to investigate one question:</font>

. . . 

```{r trophy, echo = FALSE, out.width = "20%", fig.align = "center"}
include_graphics("https://i.etsystatic.com/17857814/r/il/fbd9a1/1578738958/il_fullxfull.1578738958_fg6q.jpg")
```

<font size='7'>**What makes a good Formula One team?**</font>

. . .

```{r speed-of-car, echo = FALSE, out.width = "50%", fig.align = "left"}
include_graphics("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQqbxZWzxCekl8tiaHKxToaUSyCVJu05QaIfw&usqp=CAU")
```

. . .

```{r make-of-car, echo = FALSE, out.width = "50%", fig.align = "right"}
include_graphics("https://www.kindpng.com/picc/m/166-1662070_mechanic-clipart-black-and-white-hd-png-download.png")
```


# Dataset

<font size='5'>Our dataset comes from combining multiple datasets from the **Ergast Developer API** and focusing only on entries in 2014-2020. The resulting dataframe was named
*f1merged_hybrid*</font>

. . .

```{r glimpse-f1merged-hybrid, echo = FALSE, out.width = "100%"}
f1merged_hybrid %>% 
  select(raceId, driverRef, constructorname, position, 
         laps, milliseconds) %>%
  head(8) %>% kable(format = "html")
```

----

<font size='6'>Specifically, we wanted to investigate the Mercedes-AMG Petronas team's success in the hybrid era. The reason for our choice:</font>

. . .

```{r race-wins-by-constructor, echo = FALSE}
f1merged_hybrid %>%
  filter(positionText == 1) %>%
count(constructorname, sort = TRUE) %>% 
  ggplot(aes(x = "",
             y = n,
             fill = constructorname)) +
  geom_bar(stat = "identity") + 
  coord_polar('y', start = 0) +
  scale_fill_manual(values = key_team_colours_wins) +
  labs(title = "Race Wins by Constructor",
       subtitle = "In the hybrid era (2014-2020)",
       fill = "Constructor") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x  = element_blank()) +
  theme_void() +
  annotate(geom = "text", x = "", y = 68,  label = "74%", 
           color = "white", size = 12, fontface = "bold") +     #Mercedes
  annotate(geom = "text", x = "", y = 18,  label = "<1%",  
           color = "white", size = 3.5, fontface = "bold") +    #Racing Point
  annotate(geom = "text", x = "", y = 11.5,  label = "12%", 
           color = "white", size = 5, fontface = "bold") +      #Red Bull
  annotate(geom = "text", x = "", y = 126, label = "12%", 
           color = "white", size = 5, fontface = "bold") +      #Ferrari
  annotate(geom = "text", x = "", y = 138,   label = "<1%",  
           color = "white", size = 3.5, fontface = "bold")      #Alpha Tauri
```

# Do Mercedes Just Get Lucky Wins?

. . .

```{r car-finish-race, echo = FALSE, out.width = "30%", fig.align = "left"}
include_graphics("https://thumbs.dreamstime.com/b/vector-formula-racing-car-reach-finish-line-formula-racing-car-reach-finish-line-110888315.jpg")
```

<div>
  <div style="float: right; width: 60%;font size='5';">Is it possible that one good Mercedes driver finishes first whilst the others don't perform as well?</div>
</div>

---

```{r finishing-position-by-constructor, echo = FALSE, warning = FALSE}
f1merged_hybrid %>%
  filter(constructorname %in% key_teams) %>%
  ggplot(aes(x = position, y = constructorname,
             fill = constructorname,
             color = constructorname)) +
  geom_boxplot(alpha = 0.6) +
  scale_fill_manual(values = key_team_colours) +
  scale_color_manual(values = key_team_colours_darker) +
  scale_x_reverse() +
  scale_y_discrete(position = "right") +
  labs(title = "Finishing Position of F1 Car Constructors",
       x = "Finishing Position",
       y = "",
       subtitle = "In the hybrid era (2014-2020)") +
  theme(legend.position = "none",
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        
        #Creates road line effect
        panel.grid.major.y = element_line(linetype = "dashed", size = 2.5)) +
  
  #Finish Lines
  geom_vline(xintercept = 0, color = "black", size = 3) +
  geom_vline(xintercept = 0, color = "white", size = 3, linetype = "dashed") +
  
  #Constructor Labels
  annotate(geom = "label", x = 18, y = "Williams",  label = "Williams", 
           color = "#0082fa", size = 4) +
  annotate(geom = "label", x = 8, y = "Red Bull",  label = "Red Bull", 
           color = "#0600ef", size = 4) +
  annotate(geom = "label", x = 4.5, y = "Mercedes",  label = "Mercedes", 
           color = "#00d2be", size = 3.5) +
  annotate(geom = "label", x = 15, y = "McLaren",  label = "McLaren", 
           color = "#ff8700", size = 4) +
  annotate(geom = "label", x = 8, y = "Ferrari",  label = "Ferrari", 
           color = "#dc0000", size = 4)
```

. . .

<font size='6'>It's clear that Mercedes drivers tend to finish in the top 5.</font>

# Are Mercedes Cars Faster?

```{r finish-flag, echo = FALSE, out.width = "100%", fig.align = "center"}
include_graphics("https://media.istockphoto.com/vectors/start-and-finish-flags-vector-id642616400?k=20&m=642616400&s=612x612&w=0&h=LN_OhnEamH3DhUiLNTBkhw1pXvwCbnPjZs8b84mBQ7Q=")
```

---

```{r constructor-speeds, echo = FALSE}
f1merged_hybrid %>%
  filter(constructorname %in% key_teams) %>%
  drop_na() %>%
  summarise(constructorname,
            "avg_lap_time_min" = ((milliseconds/laps)/60000) %>% round(5)) %>%
  group_by(constructorname) %>%
  ggplot(aes(x = avg_lap_time_min, y = constructorname, 
             fill = constructorname,
             color = constructorname)) +
  geom_boxplot(alpha = 0.6, width = 0.7) +
  scale_x_reverse() +
  coord_cartesian(xlim = c(2.5,1)) +
  scale_fill_manual(values = key_team_colours) +
  scale_color_manual(values = key_team_colours_darker) +
  theme(legend.position = "none",
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        
        #Creates road line effect
        panel.grid.major.y = element_line(linetype = "dashed", size = 2.5)) +
  
  labs(title = "Average Lap Time of Formula 1 Racers",
       x = "Lap Time (Minutes)",
       y = "Constructor",
       subtitle = "In the hybrid era (2014-2020)") +
  
  #Constructor Labels
  annotate(geom = "label", x = 1.25, y = "Williams",  label = "Williams", 
           color = "#0082fa", size = 4) +
  annotate(geom = "label", x = 1.25, y = "Red Bull",  label = "Red Bull", 
           color = "#0600ef", size = 4) +
  annotate(geom = "label", x = 1.25, y = "Mercedes",  label = "Mercedes", 
           color = "#00d2be", size = 4) +
  annotate(geom = "label", x = 1.25, y = "McLaren",  label = "McLaren", 
           color = "#ff8700", size = 4) +
  annotate(geom = "label", x = 1.25, y = "Ferrari",  label = "Ferrari", 
           color = "#dc0000", size = 4)
```


## Does This Tiny Speed Advantage Make a Difference?

---

```{r lap-time-vs-finishing-position, echo = FALSE}
f1merged_hybrid %>%
  filter(constructorname %in% key_teams) %>%
  summarise(constructorname, 
            "avg_lap_time_min" = ((milliseconds/laps)/60000) %>% round(5),
            position) %>%
  drop_na() %>%
  ggplot(aes(x = avg_lap_time_min, y = position)) +
  scale_x_reverse() +
  scale_y_reverse() +
  geom_jitter(alpha = 0.5, color = "azure4") +
  geom_smooth(method = lm, formula = y ~ x, color = "black") +
  theme_minimal() +
  labs(title = "Effect of Speed on Finishing Position",
       x = "Average Lap Time (minutes)",
       y = "Finishing Position",
       subtitle = "In the hybrid era (2014-2020)")
```

. . .

In short, no.